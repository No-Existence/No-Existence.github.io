<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Redis | Insular Oasis</title><meta name="keywords" content="Redis"><meta name="author" content="张海达"><meta name="copyright" content="张海达"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="NoSQL什么是NoSQLNoSQL，泛指非关系型的数据库 NoSQL最常见的解释是“non-relational”， “Not Only SQL”也被很多人接受。NoSQL仅仅是一个概念，泛指非关系 型的数据库，区别于关系数据库，它们不保证关系数据的ACID特性。 为什么用NoSQL传统的数据库遇到的瓶颈 现在网站的特点   高并发读写 高容量存储和高效存储 高扩展性和高可用性  传统的关系数据">
<meta property="og:type" content="article">
<meta property="og:title" content="Redis">
<meta property="og:url" content="https://no-existence.github.io/08Redis/index.html">
<meta property="og:site_name" content="Insular Oasis">
<meta property="og:description" content="NoSQL什么是NoSQLNoSQL，泛指非关系型的数据库 NoSQL最常见的解释是“non-relational”， “Not Only SQL”也被很多人接受。NoSQL仅仅是一个概念，泛指非关系 型的数据库，区别于关系数据库，它们不保证关系数据的ACID特性。 为什么用NoSQL传统的数据库遇到的瓶颈 现在网站的特点   高并发读写 高容量存储和高效存储 高扩展性和高可用性  传统的关系数据">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://no-existence.github.io/img/cover/Redis.png">
<meta property="article:published_time" content="2021-09-21T14:14:01.000Z">
<meta property="article:modified_time" content="2021-09-25T12:47:24.523Z">
<meta property="article:author" content="张海达">
<meta property="article:tag" content="Redis">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://no-existence.github.io/img/cover/Redis.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://no-existence.github.io/08Redis/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Redis',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-09-25 20:47:24'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">44</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">17</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/cover/Redis.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Insular Oasis</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Redis</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-09-21T14:14:01.000Z" title="发表于 2021-09-21 22:14:01">2021-09-21</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-09-25T12:47:24.523Z" title="更新于 2021-09-25 20:47:24">2021-09-25</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Redis"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="NoSQL"><a href="#NoSQL" class="headerlink" title="NoSQL"></a>NoSQL</h2><h3 id="什么是NoSQL"><a href="#什么是NoSQL" class="headerlink" title="什么是NoSQL"></a>什么是NoSQL</h3><p>NoSQL，泛指非关系型的数据库</p>
<p>NoSQL最常见的解释是“non-relational”， “Not Only SQL”也被很多人接受。NoSQL仅仅是一个概念，泛指非关系 型的数据库，<strong>区别于关系数据库，它们不保证关系数据的ACID特性</strong>。</p>
<h3 id="为什么用NoSQL"><a href="#为什么用NoSQL" class="headerlink" title="为什么用NoSQL"></a>为什么用NoSQL</h3><p><strong>传统的数据库遇到的瓶颈</strong></p>
<p>现在网站的特点 </p>
<ul>
<li>高并发读写</li>
<li>高容量存储和高效存储</li>
<li>高扩展性和高可用性</li>
</ul>
<p>传统的关系数据库具有不错的性能，高稳定型，久经历史考验，而且使用简单，功能强大, 但较难应对现在网站的上述特点所导致的问题</p>
<p><strong>NoSql数据库的优势</strong></p>
<ul>
<li><p>易扩展</p>
<p>NoSQL数据库种类繁多，但是一个共同的特点都是去掉关系数据库的关系型特性。数据之间无关系，这 样就 非常容易扩展。也无形之间，在架构的层面上带来了可扩展的能力。</p>
</li>
<li><p>大数据量，高性能</p>
<p>NoSQL的Cache是记录级的，是一种细 粒度的Cache，所以 NoSQL在这个层面上来说就要性能高很多了</p>
</li>
<li><p>灵活的数据模型</p>
<p>NoSQL无需事先为要存储的数据建立字段，随时可以存储自定义的数据格式。</p>
</li>
<li><p>高可用</p>
<p>NoSQL在不太影响性能的情况，就可以方便的实现高可用的架构。</p>
</li>
</ul>
<h3 id="常用NoSQL产品"><a href="#常用NoSQL产品" class="headerlink" title="常用NoSQL产品"></a>常用NoSQL产品</h3><p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210909202301281.png" alt="image-20210909202301281"></p>
<h2 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p>REmote DIctionary Server（远程字典服务器）。完全开源免费的，C语言编写，遵守BCD协议。</p>
<p>是 一个高性能的(key/value)分布式内存数据库。</p>
<h4 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h4><ol>
<li>Redis支持数据的持久化，可以将内存中的数据保持在磁盘中，重启的时候可以再次加载进行使用</li>
<li>Redis不仅仅支持简单的key-value类型的数据，同时还提供list，set，zset，hash等数据结构的存储</li>
<li> Redis支持数据的备份，即master-slave(主从)模式的数据备份</li>
</ol>
<h4 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h4><ol>
<li>性能极高 – Redis能读的速度是110000次/s,写的速度是81000次/s 。</li>
<li>丰富的数据类型 – Redis支持二进制案例的 Strings, Lists, Hashes, Sets 及 Ordered Sets 数据类型操作。</li>
<li>原子 – Redis的所有操作都是原子性的，同时Redis还支持对几个操作全并后的原子性执行。 </li>
<li>丰富的特性 – Redis还支持 publish/subscribe, 通知, key 过期等等特性</li>
<li>采用单线程，避免了不必要的上下文切换和竞争条件，也不存在多进程或者多线程导致的切换而消耗 CPU，不 用去考虑各种锁的问题，不存在加锁释放锁操作，没有因为可能出现死锁而导致的性能消耗； </li>
<li>使用多路I/O复用模型，非阻塞IO；</li>
</ol>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>安装gcc</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install gcc-c++</span><br></pre></td></tr></table></figure>

<p>按y确定</p>
<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210910193907900.png" alt="image-20210910193907900"></p>
<p>借助SecureFX传送redis的压缩包到 /root/MyFile目录下</p>
<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210910193817141.png" alt="image-20210910193817141"></p>
<p>解压</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /root/MyFile</span><br><span class="line">tar -zxvf redis-5.0.5.tar.gz</span><br></pre></td></tr></table></figure>

<p>编译。如果编译过程中出错，先删除安装文件目录，后解压重新编译。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd redis-5.0.5</span><br><span class="line">make</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210910194408039.png" alt="image-20210910194408039"></p>
<p>安装</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make PREFIX=/root/MyFile/redis install</span><br></pre></td></tr></table></figure>

<p>其中，PREFIX的值为自定的redis安装路径</p>
<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210910194441988.png" alt="image-20210910194441988"></p>
<p>查看bin目录下的命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /root/MyFile/redis/bin</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210910194737827.png" alt="image-20210910194737827"></p>
<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210910194813352.png" alt="image-20210910194813352"></p>
<p> 将配置文件拷贝到自定义的路径下。Redis启动需要这个配置文件修改端口号信息。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /root/MyFile/redis-5.0.5/</span><br><span class="line">cp redis.conf /root/MyFile/redis</span><br></pre></td></tr></table></figure>



<h3 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h3><p><strong>前端模式启动</strong></p>
<p>直接运行bin/redis-server将使永前端模式启动，前端模式启动的缺点是启动完成后，不能再进行其他操作，如果 要操作必须使用ctrl+c，同时redis-server程序结束，不推荐此方法。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /root/MyFile/redis/bin</span><br><span class="line">./redis-server</span><br></pre></td></tr></table></figure>

<p>下面是启动界面(这个界面只能启动，启动后不能进行其他操作)</p>
<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210910195258445.png" alt="image-20210910195258445"></p>
<p>使用ctrl+c退出前端启动。</p>
<p><strong>后端模式启动</strong></p>
<p>修改redis.conf配置文件，设置:daemonize yes,然后可以使用后端模式启动。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi redis.conf</span><br></pre></td></tr></table></figure>

<p>配置文件中设置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">daemonize yes</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210910200406049.png" alt="image-20210910200406049"></p>
<p>回到 redis目录 ，启动并指定配置文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ..</span><br><span class="line">./bin/redis-server ./redis.conf</span><br></pre></td></tr></table></figure>

<p>查看当前服务，看到redis的默认端口是6379</p>
<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210910200450103.png" alt="image-20210910200450103"></p>
<p><strong>客户端访问redis</strong></p>
<p>如果想要通过指令来操作redis，可以使用redis的客户端进行操作,在bin文件夹下运行redis-cli 该指令默认连接的127.0.0.1 ，端口号是6379</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./redis-cli</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210910200723163.png" alt="image-20210910200723163"></p>
<p>如果想要连接指定的ip地址以及端口号，则需要按照</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -h ip地址 -p 端口号</span><br></pre></td></tr></table></figure>



<p><strong>向redis 服务器发送命令</strong></p>
<p>Ping，测试客户端与Redis的连接是否正常，如果连接正常，回收到pong</p>
<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210910200850951.png" alt="image-20210910200850951"></p>
<p>退出客户端</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">quit</span><br></pre></td></tr></table></figure>



<h3 id="停止"><a href="#停止" class="headerlink" title="停止"></a>停止</h3><p>方法1 ：强制结束程序。强制终止Redis进程可能会导致redis持久化数据丢失</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ps -aux | grep -i redis</span><br><span class="line">kill -9 [这里是上面查到的pid]</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210910201127785.png" alt="image-20210910201127785"></p>
<p>方法2 ： 正确停止Redis的方式应该是向Redis发送SHUTDOWN命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/redis-cli shutdown</span><br></pre></td></tr></table></figure>



<h3 id="第三方工具操作redis"><a href="#第三方工具操作redis" class="headerlink" title="第三方工具操作redis"></a>第三方工具操作redis</h3><p>Linux关闭防火墙</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi redis.conf</span><br></pre></td></tr></table></figure>

<p>修改redis.conf，以使得外界能访问redis</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bind Linux的ip地址</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210910202921519.png" alt="image-20210910202921519"></p>
<p>客户端访问</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./bin/redis-server ./redis.conf</span><br><span class="line">./bin/redis-cli -h Linux虚拟机地址 -p 端口号</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210910203117306.png" alt="image-20210910203117306"></p>
<p>打开 Redis Desktop Manager ，在Host和Post中分别输入上述ip地址和端口号，Name随意</p>
<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210910203514205.png" alt="image-20210910203514205"></p>
<p>能看到redis数据库</p>
<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210910203633674.png" alt="image-20210910203633674"></p>
<h3 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a>数据结构</h3><p>Redis是一种基于内存的数据库，并且提供一定的持久化功能，它是一种键值（key-value）数据库，使用 key 作为 索引找到当前缓存的数据，并且返回给程序调用者。</p>
<p>当前的 Redis 支持 6 种数据类型，详见下表</p>
<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210910203911614.png" alt="image-20210910203911614"></p>
<h3 id="常用指令"><a href="#常用指令" class="headerlink" title="常用指令"></a>常用指令</h3><p>命令学习网站:<a target="_blank" rel="noopener" href="http://doc.redisfans.com/index.html">http://doc.redisfans.com/index.html</a></p>
<h4 id="String"><a href="#String" class="headerlink" title="String"></a>String</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">set key value  # 赋值</span><br><span class="line">get key        # 取值</span><br><span class="line">MSET key1 value1 key2 value2 ... # 设置多个键值对</span><br><span class="line">MGET key1 key2 ...  # 获取多个键的值</span><br><span class="line">del key   # 删除键</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210910204515328.png" alt="image-20210910204515328"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">incr key   # 自增</span><br><span class="line">decr key   # 自减</span><br><span class="line">incrby key step #指定步长自增</span><br><span class="line">decrby key step #指定步长自减</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210912105007125.png" alt="image-20210912105007125"></p>
<h4 id="Hash-散列"><a href="#Hash-散列" class="headerlink" title="Hash 散列"></a>Hash 散列</h4><p>提供了字段和字段值的映射</p>
<p>字段值只能是字符串类型，不支持散列类型、集合类型等其它类 型。相当于是对象格式的存储</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">HSET key field value # 设置字段值 ，增加字段返回1，修改字段返回0</span><br><span class="line">HGET key field       # 获取字段值</span><br><span class="line">HMSET key1 field1 value1 field2 value2 [...] # 设置多个字段值</span><br><span class="line">HMGET key field1 field2 [...]  # 获取多个字段值</span><br><span class="line">HMGETALL key                   # 获取所有字段值</span><br><span class="line">HDEL key field1 field2 [...]   # 删除字段1至多个</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210912105838414.png" alt="image-20210912105838414"></p>
<h4 id="List-队列"><a href="#List-队列" class="headerlink" title="List 队列"></a>List 队列</h4><p>Redis的list是采用来链表来存储,双向链表存储数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">LPUSH key value [value2 ...]   # 队列左边加入元素</span><br><span class="line">LPOP key                       # 队列左边弹出元素</span><br><span class="line">RPUSH key value [value2 ...]</span><br><span class="line">RPOP key</span><br><span class="line">LLEN key    # 获取列表中元素的个数</span><br><span class="line">LRANGE key start stop   # 查看列表</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210912110352797.png" alt="image-20210912110352797"></p>
<h4 id="Set-集合"><a href="#Set-集合" class="headerlink" title="Set 集合"></a>Set 集合</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SADD key member [member2 ...]  # 增加元素</span><br><span class="line">SREM key member [member2 ...]  # 删除元素</span><br><span class="line">SMEMBERS key  # 查看集合中所有元素</span><br><span class="line">SISMEMBER key member  # 查看是否在集合中</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210912110851142.png" alt="image-20210912110851142"></p>
<h4 id="Zset-有序集合"><a href="#Zset-有序集合" class="headerlink" title="Zset 有序集合"></a>Zset 有序集合</h4><p>会为集合中的元素增加一个score字段，根据score字段排序</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ZADD key score member [score2 member2 ...]  # 增加元素</span><br><span class="line">ZREVRANGE key start stop [WITHSCORES] # 获取某范围内的元素列表并按元素score降序返回</span><br><span class="line">ZSCORE key member  # 获取元素分数</span><br><span class="line">ZREM key member    # 删除元素</span><br><span class="line">ZINCRBY key step member  # 为某一属性加减score</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210912112131450.png" alt="image-20210912112131450"></p>
<h4 id="HyoperLogLog指令"><a href="#HyoperLogLog指令" class="headerlink" title="HyoperLogLog指令"></a>HyoperLogLog指令</h4><p>HyperLogLog是一种使用随机化的算法，以少量内存提供集合中唯一元素数量的近似值。 </p>
<p>HyperLogLog 可以接受多个元素作为输入，并给出输入元素的基数估算值： </p>
<ul>
<li>基数：集合中不同元素的数量。比如 {‘apple’, ‘banana’, ‘cherry’, ‘banana’, ‘apple’} 的基数就是 3 。 </li>
<li>估算值：算法给出的基数并不是精确的，可能会比实际稍微多一些或者稍微少一些，但会控制在合理的范围之内。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">PFADD key ele [ele2 ...]  # 将指定的元素添加到指定的HyperLogLog 中</span><br><span class="line">PFCOUNT key [key2 ...]	  # 返回给定 HyperLogLog 的基数估算值</span><br><span class="line">PFMAERGE destkey srckey [srckey2 ...] # 将多个 HyperLogLog 合并为一个 HyperLogLog</span><br></pre></td></tr></table></figure>



<h4 id="其他指令"><a href="#其他指令" class="headerlink" title="其他指令"></a>其他指令</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">keys pattern   # 查看所有满足pattern模式的key，如 keys *(查看所有key),keys user*(查看所有user开头的key) </span><br><span class="line">existd key    # 确认key是否存在</span><br><span class="line">del key       # 删除一个key</span><br><span class="line">rename oldkey new key # 重命名</span><br><span class="line">type key      # 查看key的类型</span><br><span class="line">expire key seconds  #设置key的生存时间</span><br><span class="line">ttl  key     # 查看剩余生存时间</span><br><span class="line">persist key  # 清除key的生存时间</span><br><span class="line">info   # 获取服务器信息和统计</span><br><span class="line">flushdb # 删除当前选择数据库的所有key</span><br><span class="line">flushall # 删除所有数据库的所有key</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210912113538488.png" alt="image-20210912113538488"></p>
<h3 id="多数据库"><a href="#多数据库" class="headerlink" title="多数据库"></a>多数据库</h3><p>一个redis实例最多可提供16个数据库，下标从0-15，客户端默认连接第0号数据库，也可以通过select选择连接哪 个数据库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select num  # 切换数据库，num范围0~15</span><br><span class="line">move key num # 将key移动到第num号数据库</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210912114038184.png" alt="image-20210912114038184"></p>
<h3 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h3><p>Redis 事务可以一次执行多个命令， 并且带有以下两个重要的保证： </p>
<ul>
<li>事务是一个单独的隔离操作：事务中的所有命令都会序列化、按顺序地执行。事务在执行的过程中，不会被其他客 户端发送来的命令请求所打断。 </li>
<li>事务是一个原子操作：事务中的命令要么全部被执行，要么全部都不执行。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">multi  # 开启事务</span><br><span class="line">...    # 若干条命令入队</span><br><span class="line">exec   # 执行事务</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210912114628324.png" alt="image-20210912114628324"></p>
<h3 id="发布订阅模式"><a href="#发布订阅模式" class="headerlink" title="发布订阅模式"></a>发布订阅模式</h3><p>Redis 发布订阅(pub/sub)是一种消息通信模式：发送者(pub)发送消息，订阅者(sub)接收消息。 </p>
<p>Redis 客户端可以订阅任意数量的频道。</p>
<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210912125245059.png" alt="image-20210912125245059"></p>
<p>需要一个redis客户端作为订阅频道，其他redis客户端作为客户</p>
<p>创建订阅频道</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">subscribe redisMessage</span><br></pre></td></tr></table></figure>

<p>客户端向订阅频道发送消息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public redisMessage &quot;msg&quot;</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210912125506710.png" alt="image-20210912125506710"></p>
<h3 id="Jedis连接Redis"><a href="#Jedis连接Redis" class="headerlink" title="Jedis连接Redis"></a>Jedis连接Redis</h3><p>Java代码借助jedis插件连接Redis的步骤</p>
<ol>
<li> <strong>创建java项目，导入依赖</strong></li>
</ol>
   <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p><strong>链接服务器</strong></p>
<p>先在本机确认远程服务器是否可以ping通</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ping 虚拟机ip地址</span><br></pre></td></tr></table></figure>

<p>如果ping不到，再确认虚拟机的防火墙是否关闭或放行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --state </span><br><span class="line">systemctl stop firewalld.service</span><br></pre></td></tr></table></figure>

<p><strong>方案一  单实例链接</strong></p>
<p>编写java代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JedisDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">&quot;192.168.184.133&quot;</span>,<span class="number">6379</span>);</span><br><span class="line">        jedis.set(<span class="string">&quot;username&quot;</span>,<span class="string">&quot;user100&quot;</span>);</span><br><span class="line">        System.out.println(jedis.get(<span class="string">&quot;username&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>查看控制台输出</p>
<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210920230524613.png" alt="image-20210920230524613"></p>
<p>查看redis数据库</p>
<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210920230251596.png" alt="image-20210920230251596"></p>
<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210913220548704.png" alt="image-20210913220548704"></p>
<p><strong>方案二 连接池</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.JedisPool;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.JedisPoolConfig;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JedisDemoPool</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 1. 获取连接池配置对象，设置配置项</span></span><br><span class="line">        JedisPoolConfig config = <span class="keyword">new</span> JedisPoolConfig();</span><br><span class="line">        config.setMaxTotal(<span class="number">30</span>); <span class="comment">// 最大连接数</span></span><br><span class="line">        config.setMaxIdle(<span class="number">10</span>);  <span class="comment">// 最大空闲</span></span><br><span class="line">        <span class="comment">// 2. 获取链接池</span></span><br><span class="line">        JedisPool jedisPool = <span class="keyword">new</span> JedisPool(config,<span class="string">&quot;192.184.168.133&quot;</span>,<span class="number">6379</span>);</span><br><span class="line">        Jedis jedis = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            jedis = jedisPool.getResource();</span><br><span class="line">            <span class="comment">// 3. 设置数据</span></span><br><span class="line">            jedis.set(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;Jerry&quot;</span>);</span><br><span class="line">            System.out.println(jedis.get(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(jedis!=<span class="keyword">null</span>) jedis.close();</span><br><span class="line">            <span class="comment">// 4. 关闭虚拟机时释放资源</span></span><br><span class="line">            <span class="keyword">if</span>(jedisPool!=<span class="keyword">null</span>) jedisPool.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>查看控制台输出</p>
<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210920230452732.png" alt="image-20210920230452732"></p>
<p>查看redis数据库</p>
<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210920230251596.png"></p>
</li>
</ol>
<h3 id="Redis持久化方案"><a href="#Redis持久化方案" class="headerlink" title="Redis持久化方案"></a>Redis持久化方案</h3><p>由于redis的值放在内存中，为防止突然断电等特殊情况的发生，需要对数据进行持久化备份。即将内存数据保存到硬盘。</p>
<h4 id="RDB"><a href="#RDB" class="headerlink" title="RDB"></a>RDB</h4><p>RDB 是以二进制文件，是在某个时间点将数据写入一个临时文件，持久化结束后，用这个临时文件替换上次持久化 的文件，达到数据恢复。 </p>
<p>优点：使用单独子进程来进行持久化，主进程不会进行任何 IO 操作，保证了 redis 的高性能 </p>
<p>缺点：RDB 是间隔一段时间进行持久化，如果持久化之间 redis 发生故障，会发生数据丢失。所以这种方式更适合 数据要求不严谨的时候</p>
<p>RDB 默认开启，redis.conf 中的具体配置参数如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#dbfilename：持久化数据存储在本地的文件</span><br><span class="line">dbfilename dump.rdb</span><br><span class="line">#dir：持久化数据存储在本地的路径，如果是在/redis/redis-5.0.5/src下启动的redis-cli，则数据会存储在当前</span><br><span class="line">src目录下</span><br><span class="line">dir ./</span><br><span class="line">##snapshot触发的时机，save</span><br><span class="line">##如下为900秒后，至少有一个变更操作，才会snapshot</span><br><span class="line">##对于此值的设置，需要谨慎，评估系统的变更操作密集程度</span><br><span class="line">##可以通过“save”来关闭snapshot功能</span><br><span class="line">#save时间，以下分别表示更改了1个key时间隔900s进行持久化存储；更改了10个key300s进行存储；更改10000个</span><br><span class="line">key60s进行存储。</span><br><span class="line">save 900 1</span><br><span class="line">save 300 10</span><br><span class="line">save 60 10000</span><br><span class="line">##当snapshot时出现错误无法继续时，是否阻塞客户端“变更操作”，“错误”可能因为磁盘已满/磁盘故障/OS级别异常等</span><br><span class="line">stop-writes-on-bgsave-error yes</span><br><span class="line">##是否启用rdb文件压缩，默认为“yes”，压缩往往意味着“额外的cpu消耗”，同时也意味这较小的文件尺寸以及较短的网</span><br><span class="line">络传输时间</span><br><span class="line">rdbcompression yes</span><br></pre></td></tr></table></figure>



<p>打开redis存储一个键值对后 shutdown 并退出redis ，会看到一个 dump.rdb 文件</p>
<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210914101230202.png" alt="image-20210914101230202"></p>
<p>如果删除dump.rbd 文件， 会发现刚在的存值消失。</p>
<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210914101450952.png" alt="image-20210914101450952"></p>
<h4 id="AOF"><a href="#AOF" class="headerlink" title="AOF"></a>AOF</h4><p>Append-Only File，将“操作 + 数据”以格式化指令的方式追加到操作日志文件的尾部，在 append 操作返回后(已经 写入到文件或者将要写入)，才进行实际的数据变更，<strong>“日志文件”保存了历史所有的操作过程</strong>；当 server 需要数据 恢复时，可以直接 replay 此日志文件，即可还原所有的操作过程。AOF 相对可靠，AOF 文件内容是字符串，非常 容易阅读和解析。 </p>
<p>优点：可以<strong>保持更高的数据完整性</strong>，如果设置追加 file 的时间是 1s，如果 redis 发生故障，最多会丢失 1s 的数 据；且如果日志写入不完整支持 redis-check-aof 来进行日志修复；AOF 文件没被 rewrite 之前（文件过大时会对 命令进行合并重写），可以删除其中的某些命令（比如误操作的 flushall）。 </p>
<p>缺点：AOF 文件比 RDB 文件大，且恢复速度慢。</p>
<p><strong>AOF 默认关闭</strong>，修改配置文件 reds.conf以开启</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">appendonly yes</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210914102405588.png" alt="image-20210914102405588"></p>
<p>启动redis ，进行一些数据库操作后退出，能看到aof文件</p>
<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210914102701805.png" alt="image-20210914102701805"></p>
<p>查看该aof文件，能看到刚才操作的内容</p>
<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210914102805634.png" alt="image-20210914102805634"></p>
<p>其他参数介绍</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">##此选项为aof功能的开关，默认为“no”，可以通过“yes”来开启aof功能</span><br><span class="line">##只有在“yes”下，aof重写/文件同步等特性才会生效</span><br><span class="line">appendonly yes</span><br><span class="line">##指定aof文件名称</span><br><span class="line">appendfilename appendonly.aof</span><br><span class="line">##指定aof操作中文件同步策略，有三个合法值：always everysec no,默认为everysec</span><br><span class="line">appendfsync everysec</span><br><span class="line">##在aof-rewrite期间，appendfsync是否暂缓文件同步，&quot;no&quot;表示“不暂缓”，“yes”表示“暂缓”，默认为“no”</span><br><span class="line">no-appendfsync-on-rewrite no</span><br><span class="line">##aof文件rewrite触发的最小文件尺寸(mb,gb),只有大于此aof文件大于此尺寸是才会触发rewrite，默认“64mb”，建</span><br><span class="line">议“512mb”</span><br><span class="line">auto-aof-rewrite-min-size 64mb</span><br><span class="line">##相对于“上一次”rewrite，本次rewrite触发时aof文件应该增长的百分比。</span><br><span class="line">##每一次rewrite之后，redis都会记录下此时“新aof”文件的大小(例如A)，那么当aof文件增长到A*(1 + p)之后</span><br><span class="line">##触发下一次rewrite，每一次aof记录的添加，都会检测当前aof文件的尺寸。</span><br><span class="line">auto-aof-rewrite-percentage 100</span><br></pre></td></tr></table></figure>



<h3 id="Redis-主从复制"><a href="#Redis-主从复制" class="headerlink" title="Redis 主从复制"></a>Redis 主从复制</h3><ol>
<li><p>切换位root用户，复制redis为从机</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp redis/ redis_sub  -r</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210918201306477.png" alt="image-20210918201306477"></p>
</li>
<li><p>修改redis.conf</p>
<p>REPLICATION条目下增加</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">replicaof 主机ip 主机端口号</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210918201223787.png" alt="image-20210918201223787"></p>
</li>
<li><p>修改从机的port地址为6380</p>
<p>NETWORK下设置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">port 6380</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210918202317167.png" alt="image-20210918202317167"></p>
</li>
<li><p>清除从机中的持久化文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm -rf appendonly.aof  dump.rdb</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210918202424809.png" alt="image-20210918202424809"></p>
</li>
<li><p>启动从机</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./bin/redis-server ./redis.conf</span><br><span class="line">./bin/redis-cli -p 6380</span><br></pre></td></tr></table></figure></li>
<li><p>停止6380客户端</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/redis-cli -p 6380 shutdown</span><br></pre></td></tr></table></figure></li>
</ol>
<ul>
<li>主机一旦发生增删改操作，那么从机会自动将数据同步到从机中 </li>
<li>从机不能执行写操作,只能读</li>
</ul>
<p><strong>复制的过程原理</strong> </p>
<p>当从库和主库建立MS(master slaver)关系后，会向主数据库发送SYNC命令； 主库接收到SYNC命令后会开始在后台保存快照（RDB持久化过程），并将期间接收到的写命令缓存起来； 快照完成后,主Redis会将快照文件和所有缓存的写命令发送给从Redis； 从Redis接收到后，会载入快照文件并且执行收到的缓存命令； 主Redis每当接收到写命令时就会将命令发送从Redis，保证数据的一致；【内部完成,所以不支持客户端在从 机人为写数据。】 </p>
<p><strong>复制架构中出现宕机情况如何解决?</strong> </p>
<p>从Redis宕机:重启就好 </p>
<p>主Redis宕机:从数据库(从机)中执行SLAVEOF NO ONE命令，断开主从关系并且提升为主库继续服务[把一个从做为 主机，这个时候新主机[之前的从机]就具备写入的能力]；主服务器修好后，重新启动后，执行SLAVEOF命令，将其设置为从库[老主机设置为从机]。</p>
<h3 id="Redis哨兵模式"><a href="#Redis哨兵模式" class="headerlink" title="Redis哨兵模式"></a>Redis哨兵模式</h3><p><strong>给集群分配一个站岗的</strong></p>
<p>哨兵的作用就是对Redis系统的运行情况监控，它是一个独立进程,它的功能： </p>
<ol>
<li>监控主数据库和从数据库是否运行正常；</li>
<li>主数据出现故障后<strong>自动</strong>将从数据库转化为主数据库；</li>
</ol>
<p> 如果主机宕，开启选举工作，选择一个从做主机。</p>
<ol>
<li><p>先创建一个主机，并通过上述的主从复制得到两个从机，主机端口号6379，两个从机端口号6380和6381.</p>
<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210920232243340.png" alt="image-20210920232243340"></p>
</li>
<li><p>删除主机和从机中的.rdb和.aof文件</p>
</li>
<li><p>确保没有redis进程在运行后</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ps -aux | grep -i redis  # 查看进程</span><br><span class="line">kill -9 [这里是上面查到的pid] # 杀死进程</span><br></pre></td></tr></table></figure>



<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210920232537148.png" alt="image-20210920232537148"></p>
</li>
<li><p>打开Xshell 创建三个会话，分别在不同会话中启动主机和从机里的redis并测试</p>
<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210920234155042.png" alt="image-20210920234155042"></p>
<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210920234714101.png" alt="image-20210920234714101"></p>
</li>
<li><p>查看主从机的信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">info replication</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210920235250689.png" alt="image-20210920235250689"></p>
<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210920235327733.png" alt="image-20210920235327733"></p>
</li>
<li><p>一个主机和一个从机quit，在退出的从机中的bin目录下创建哨兵配置文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd bin</span><br><span class="line">vi sentinel.conf</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sentinel monitor mastername 192.168.184.120 6379 1</span><br><span class="line"># sentinel monitor 自定义监控主数据名 主数据库ip 端口 最低通过票数</span><br></pre></td></tr></table></figure></li>
<li><p>启动哨兵</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./redis-sentinel ./sentinel.conf &gt;sent.log &amp;</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210921000359292.png" alt="image-20210921000359292"></p>
<p>启动redis服务后，程序会自动配置文件sentinel.conf，并生成内容，注意:若再起启动需要删除下生成的内容。 </p>
<p>哨兵启动方式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./redis-server sentinel.conf --sentinel</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210921000845014.png" alt="image-20210921000845014"></p>
<p>能查看到哨兵进程</p>
<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210921001010012.png" alt="image-20210921001010012"></p>
</li>
<li><p>模拟宕机</p>
<p>关闭主机进程</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kill -9 [主机的redis-server的进程id]</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210921001149326.png" alt="image-20210921001149326"></p>
</li>
<li><p>查看从机的信息，能看到有台从机被设置成了master</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">info replication</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210921001356911.png" alt="image-20210921001356911"></p>
</li>
<li><p>测试数据存取</p>
<p>在6381存入数据，能在6380取得</p>
<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210921001527223.png" alt="image-20210921001527223"></p>
<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210921001547181.png" alt="image-20210921001547181"></p>
</li>
</ol>
<p>主从集群：主机有写入权限。从机没有，只有可读。 </p>
<p>意外宕机方案: </p>
<ul>
<li>手动恢复：人为重启服务器，主机宕，把从机设置为主机。 </li>
<li>自动恢复：使用哨兵监控。自动切换主从。</li>
</ul>
<h3 id="Redis集群"><a href="#Redis集群" class="headerlink" title="Redis集群"></a>Redis集群</h3><h4 id="集群原理"><a href="#集群原理" class="headerlink" title="集群原理"></a>集群原理</h4><p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210921001815776.png" alt="image-20210921001815776"></p>
<p><strong>架构细节</strong></p>
<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210921001832858.png" alt="image-20210921001832858"></p>
<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210921002048427.png" alt="image-20210921002048427"></p>
<p><strong>心跳机制</strong></p>
<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210921002111951.png" alt="image-20210921002111951"></p>
<h4 id="集群搭建步骤"><a href="#集群搭建步骤" class="headerlink" title="集群搭建步骤"></a>集群搭建步骤</h4><ol>
<li><p>安装redis</p>
</li>
<li><p>创建集群目录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir redis-cluster</span><br></pre></td></tr></table></figure></li>
<li><p>在集群目录下创建结点目录</p>
<p>三主三从，端口号分别从7001到7006</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp redis/ redis-cluster/7001 -r</span><br></pre></td></tr></table></figure></li>
<li><p>删除持久化文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm -rf appendonly.aof dump.rdb</span><br></pre></td></tr></table></figure></li>
<li><p>修改redis.conf文件</p>
<p>查找cluster-enabled ， 设置为yes</p>
<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210921002948362.png" alt="image-20210921002948362"></p>
<p>修改端口号</p>
<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210921003105894.png" alt="image-20210921003105894"></p>
</li>
<li><p>由7001复制出7002~7006，同时修改各机器的端口号</p>
<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210921003246392.png" alt="image-20210921003246392"></p>
</li>
<li><p>编写shell脚本来启动六台机器，记得修改shell脚本的权限</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi startall.sh</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">cd 7001</span><br><span class="line">./bin/redis-server ./redis.conf</span><br><span class="line">cd ..</span><br><span class="line">cd 7002</span><br><span class="line">./bin/redis-server ./redis.conf</span><br><span class="line">cd ..</span><br><span class="line">cd 7003</span><br><span class="line">./bin/redis-server ./redis.conf</span><br><span class="line">cd ..</span><br><span class="line">cd 7004</span><br><span class="line">./bin/redis-server ./redis.conf</span><br><span class="line">cd ..</span><br><span class="line">cd 7005</span><br><span class="line">./bin/redis-server ./redis.conf</span><br><span class="line">cd ..</span><br><span class="line">cd 7006</span><br><span class="line">./bin/redis-server ./redis.conf</span><br><span class="line">cd ..</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod 777 startall.sh</span><br><span class="line">./startall.sh</span><br></pre></td></tr></table></figure></li>
<li><p>关闭防火墙，创建集群</p>
<p>在任意一台上运行以下指令。不要在每台机器上都运行，一台就够了 redis 5.0.5中使用redis-cli –cluster替代redistrib.rb</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd 7001/bin</span><br><span class="line">./redis-cli --cluster create 192.168.184.120:7001 192.168.184.120:7002 192.168.184.120:7003 192.168.184.120:7004 192.168.184.120:7005 192.168.184.120:7006 --cluster-replicas 1</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210921004255526.png" alt="image-20210921004255526"></p>
<p>输入yes</p>
<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210921004345166.png" alt="image-20210921004345166"></p>
</li>
<li><p>连接集群</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/redis-cli -h 192.168.184.120 -p 7001 -c # 指定集群连接</span><br></pre></td></tr></table></figure>

<p>在7001中存值，能自动连接到7003。表示集群搭建成功</p>
<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210921004802803.png" alt="image-20210921004802803"></p>
</li>
<li><p>查看集群信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cluster info  # 集群信息</span><br><span class="line">cluster nodes # 结点信息</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/image-20210921004935918.png" alt="image-20210921004935918"></p>
</li>
</ol>
<h3 id="Jedis连接集群"><a href="#Jedis连接集群" class="headerlink" title="Jedis连接集群"></a>Jedis连接集群</h3><ol>
<li><p>关闭防火墙 </p>
<p>如果redis重启，需要将redis中生成的dump.rdb和nodes.conf文件删除，然后再重启</p>
</li>
<li><p>java导入maven依赖</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;redis.clients&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;jedis&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">2.9</span><span class="number">.0</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>注意jedis的版本，其他版本有可能报错:java.lang.NumberFormatException: For input string: “7002@17002”</p>
</li>
<li><p>编写类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> redis.clients.jedis.HostAndPort;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.JedisCluster;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JedisClusterDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 创建一连接，JedisCluster对象,在系统中是单例存在</span></span><br><span class="line">        Set&lt;HostAndPort&gt; nodes = <span class="keyword">new</span> HashSet&lt;HostAndPort&gt;();</span><br><span class="line">        nodes.add(<span class="keyword">new</span> HostAndPort(<span class="string">&quot;192.168.184.120&quot;</span>, <span class="number">7001</span>));</span><br><span class="line">        nodes.add(<span class="keyword">new</span> HostAndPort(<span class="string">&quot;192.168.184.120&quot;</span>, <span class="number">7002</span>));</span><br><span class="line">        nodes.add(<span class="keyword">new</span> HostAndPort(<span class="string">&quot;192.168.184.120&quot;</span>, <span class="number">7003</span>));</span><br><span class="line">        nodes.add(<span class="keyword">new</span> HostAndPort(<span class="string">&quot;192.168.184.120&quot;</span>, <span class="number">7004</span>));</span><br><span class="line">        nodes.add(<span class="keyword">new</span> HostAndPort(<span class="string">&quot;192.168.184.120&quot;</span>, <span class="number">7005</span>));</span><br><span class="line">        nodes.add(<span class="keyword">new</span> HostAndPort(<span class="string">&quot;192.168.184.120&quot;</span>, <span class="number">7006</span>));</span><br><span class="line">        JedisCluster cluster = <span class="keyword">new</span> JedisCluster(nodes);</span><br><span class="line">        <span class="comment">// 执行JedisCluster对象中的方法，方法和redis指令一一对应。</span></span><br><span class="line">        cluster.set(<span class="string">&quot;test1&quot;</span>, <span class="string">&quot;test111&quot;</span>);</span><br><span class="line">        String result = cluster.get(<span class="string">&quot;test1&quot;</span>);</span><br><span class="line">        System.out.println(result);</span><br><span class="line">        <span class="comment">//存储List数据到列表中</span></span><br><span class="line">        cluster.lpush(<span class="string">&quot;site-list&quot;</span>, <span class="string">&quot;java&quot;</span>);</span><br><span class="line">        cluster.lpush(<span class="string">&quot;site-list&quot;</span>, <span class="string">&quot;c&quot;</span>);</span><br><span class="line">        cluster.lpush(<span class="string">&quot;site-list&quot;</span>, <span class="string">&quot;mysql&quot;</span>);</span><br><span class="line">        <span class="comment">// 获取存储的数据并输出</span></span><br><span class="line">        List&lt;String&gt; list = cluster.lrange(<span class="string">&quot;site-list&quot;</span>, <span class="number">0</span> ,<span class="number">2</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;list.size(); i++) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;列表项为: &quot;</span>+list.get(i));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 程序结束时需要关闭JedisCluster对象</span></span><br><span class="line">        cluster.close();</span><br><span class="line">        System.out.println(<span class="string">&quot;集群测试成功！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>查看运行结果</p>
<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/jedis%E9%9B%86%E7%BE%A41.png" alt="image-20210921010508459"></p>
<p><img src="https://gitee.com/ji-ce-xiang/blog-image/raw/master/img/jedis%E9%9B%86%E7%BE%A42.png" alt="image-20210921010700799"></p>
</li>
</ol>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">张海达</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://no-existence.github.io/08Redis/">https://no-existence.github.io/08Redis/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://no-existence.github.io" target="_blank">Insular Oasis</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Redis/">Redis</a></div><div class="post_share"><div class="social-share" data-image="/img/cover/Redis.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/09SSM-1Spring/"><img class="prev-cover" src="/img/cover/spring.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Spring</div></div></a></div><div class="next-post pull-right"><a href="/3-1%E5%BF%AB%E9%80%9F%E6%8E%92%E5%BA%8F%E5%8F%8A%E4%BC%98%E5%8C%96/"><img class="next-cover" src="/img/cover/Leetcode.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Leetcode 快速排序及优化</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">张海达</div><div class="author-info__description">张海达的个人博客</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">44</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">17</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/No-Existence"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/No-Existence" target="_blank" title="Github"><i class="fab fa-github"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#NoSQL"><span class="toc-number">1.</span> <span class="toc-text">NoSQL</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFNoSQL"><span class="toc-number">1.1.</span> <span class="toc-text">什么是NoSQL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E7%94%A8NoSQL"><span class="toc-number">1.2.</span> <span class="toc-text">为什么用NoSQL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8NoSQL%E4%BA%A7%E5%93%81"><span class="toc-number">1.3.</span> <span class="toc-text">常用NoSQL产品</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis"><span class="toc-number">2.</span> <span class="toc-text">Redis</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-number">2.1.</span> <span class="toc-text">概述</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%B9%E7%82%B9"><span class="toc-number">2.1.1.</span> <span class="toc-text">特点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%98%E5%8A%BF"><span class="toc-number">2.1.2.</span> <span class="toc-text">优势</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85"><span class="toc-number">2.2.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8"><span class="toc-number">2.3.</span> <span class="toc-text">启动</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%81%9C%E6%AD%A2"><span class="toc-number">2.4.</span> <span class="toc-text">停止</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E6%96%B9%E5%B7%A5%E5%85%B7%E6%93%8D%E4%BD%9Credis"><span class="toc-number">2.5.</span> <span class="toc-text">第三方工具操作redis</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-number">2.6.</span> <span class="toc-text">数据结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4"><span class="toc-number">2.7.</span> <span class="toc-text">常用指令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#String"><span class="toc-number">2.7.1.</span> <span class="toc-text">String</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Hash-%E6%95%A3%E5%88%97"><span class="toc-number">2.7.2.</span> <span class="toc-text">Hash 散列</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#List-%E9%98%9F%E5%88%97"><span class="toc-number">2.7.3.</span> <span class="toc-text">List 队列</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Set-%E9%9B%86%E5%90%88"><span class="toc-number">2.7.4.</span> <span class="toc-text">Set 集合</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Zset-%E6%9C%89%E5%BA%8F%E9%9B%86%E5%90%88"><span class="toc-number">2.7.5.</span> <span class="toc-text">Zset 有序集合</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HyoperLogLog%E6%8C%87%E4%BB%A4"><span class="toc-number">2.7.6.</span> <span class="toc-text">HyoperLogLog指令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E6%8C%87%E4%BB%A4"><span class="toc-number">2.7.7.</span> <span class="toc-text">其他指令</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">2.8.</span> <span class="toc-text">多数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1"><span class="toc-number">2.9.</span> <span class="toc-text">事务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.10.</span> <span class="toc-text">发布订阅模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Jedis%E8%BF%9E%E6%8E%A5Redis"><span class="toc-number">2.11.</span> <span class="toc-text">Jedis连接Redis</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis%E6%8C%81%E4%B9%85%E5%8C%96%E6%96%B9%E6%A1%88"><span class="toc-number">2.12.</span> <span class="toc-text">Redis持久化方案</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#RDB"><span class="toc-number">2.12.1.</span> <span class="toc-text">RDB</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AOF"><span class="toc-number">2.12.2.</span> <span class="toc-text">AOF</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis-%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6"><span class="toc-number">2.13.</span> <span class="toc-text">Redis 主从复制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.14.</span> <span class="toc-text">Redis哨兵模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis%E9%9B%86%E7%BE%A4"><span class="toc-number">2.15.</span> <span class="toc-text">Redis集群</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9B%86%E7%BE%A4%E5%8E%9F%E7%90%86"><span class="toc-number">2.15.1.</span> <span class="toc-text">集群原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA%E6%AD%A5%E9%AA%A4"><span class="toc-number">2.15.2.</span> <span class="toc-text">集群搭建步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Jedis%E8%BF%9E%E6%8E%A5%E9%9B%86%E7%BE%A4"><span class="toc-number">2.16.</span> <span class="toc-text">Jedis连接集群</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/Dubbo/" title="Dubbo"><img src="/img/cover.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Dubbo"/></a><div class="content"><a class="title" href="/Dubbo/" title="Dubbo">Dubbo</a><time datetime="2022-03-06T07:42:10.000Z" title="发表于 2022-03-06 15:42:10">2022-03-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/%5BOSTEP-2a%5DFree-sapce%20Management/" title="无题"><img src="/img/cover.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"/></a><div class="content"><a class="title" href="/%5BOSTEP-2a%5DFree-sapce%20Management/" title="无题">无题</a><time datetime="2021-10-24T04:11:33.004Z" title="发表于 2021-10-24 12:11:33">2021-10-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/%5BOSTEP-1b%5Dxv6%20System%20Call/" title="OSTEP-Project-1b xv6 System Call"><img src="/img/cover/OSTEP.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="OSTEP-Project-1b xv6 System Call"/></a><div class="content"><a class="title" href="/%5BOSTEP-1b%5Dxv6%20System%20Call/" title="OSTEP-Project-1b xv6 System Call">OSTEP-Project-1b xv6 System Call</a><time datetime="2021-10-02T12:16:19.000Z" title="发表于 2021-10-02 20:16:19">2021-10-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/09SSM-2SpringMVC/" title="Spring MVC"><img src="/img/cover/spring.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Spring MVC"/></a><div class="content"><a class="title" href="/09SSM-2SpringMVC/" title="Spring MVC">Spring MVC</a><time datetime="2021-09-29T08:44:07.000Z" title="发表于 2021-09-29 16:44:07">2021-09-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/3-2%E5%BD%92%E5%B9%B6%E6%8E%92%E5%BA%8F/" title="Leetcode 归并排序"><img src="/img/cover/Leetcode.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Leetcode 归并排序"/></a><div class="content"><a class="title" href="/3-2%E5%BD%92%E5%B9%B6%E6%8E%92%E5%BA%8F/" title="Leetcode 归并排序">Leetcode 归并排序</a><time datetime="2021-09-27T08:00:19.000Z" title="发表于 2021-09-27 16:00:19">2021-09-27</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By 张海达</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"></div><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>